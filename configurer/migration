import { BaseMigration, type DatabaseImpl } from '@athenna/database'

export class CreateJobsTable extends BaseMigration {
  public tableName = 'jobs'

  public async up(db: DatabaseImpl) {
    return db.createTable(this.tableName, builder => {
      builder.increments('id')
      builder.string('queue').notNullable().index()
      builder.string('data').notNullable()
      builder.tinyint('attempts').defaultTo(1).unsigned()
      builder.integer('availableAt').nullable().unsigned()
      builder.integer('reservedUntil').nullable().unsigned()
      builder.integer('createdAt').nullable().unsigned()
    })
  }

  public async down(db: DatabaseImpl) {
    return db.dropTable(this.tableName)
  }
}
